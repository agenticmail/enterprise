<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ€ AgenticMail Enterprise Dashboard</title>
  <style>
    /*
     * ğŸ€ AgenticMail Enterprise â€” Pure HTML Dashboard
     * 
     * ZERO dependencies. No Node.js, no npm, no React, no build tools.
     * Just open this file in any browser.
     *
     * Setup:
     *   1. Edit the API_URL below to point to your ğŸ€ AgenticMail Enterprise server
     *   2. Open this file in any browser (or host it on any web server)
     *   3. Login with your admin credentials
     *
     * That's it. No coding required.
     */

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root, [data-theme="light"] {
      --bg: #f8f9fa; --surface: #ffffff; --surface-hover: #f1f3f5;
      --border: #dee2e6; --border-hover: #ced4da;
      --text: #212529; --text-dim: #495057; --text-muted: #868e96;
      --primary: #e84393; --primary-hover: #d63384; --primary-bg: rgba(232,67,147,0.08);
      --success: #2b8a3e; --success-bg: rgba(43,138,62,0.08);
      --warning: #e67700; --warning-bg: rgba(230,119,0,0.08);
      --danger: #c92a2a; --danger-bg: rgba(201,42,42,0.08);
      --radius: 6px; --radius-lg: 10px;
      --shadow: 0 1px 3px rgba(0,0,0,0.08);
      --font: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', system-ui, sans-serif;
      color-scheme: light dark;
    }
    [data-theme="dark"] {
      --bg: #0f1114; --surface: #16181d; --surface-hover: #1c1f26;
      --border: #2c3038; --border-hover: #3b414c;
      --text: #e1e4e8; --text-dim: #b0b8c4; --text-muted: #6b7280;
      --primary: #f06595; --primary-hover: #f783ac; --primary-bg: rgba(240,101,149,0.1);
      --success: #37b24d; --success-bg: rgba(55,178,77,0.1);
      --warning: #f08c00; --warning-bg: rgba(240,140,0,0.1);
      --danger: #f03e3e; --danger-bg: rgba(240,62,62,0.1);
      --shadow: 0 1px 3px rgba(0,0,0,0.3);
    }
    @media (prefers-color-scheme: dark) {
      :root:not([data-theme="light"]) {
        --bg: #0f1114; --surface: #16181d; --surface-hover: #1c1f26;
        --border: #2c3038; --border-hover: #3b414c;
        --text: #e1e4e8; --text-dim: #b0b8c4; --text-muted: #6b7280;
        --primary: #f06595; --primary-hover: #f783ac; --primary-bg: rgba(240,101,149,0.1);
        --success: #37b24d; --success-bg: rgba(55,178,77,0.1);
        --warning: #f08c00; --warning-bg: rgba(240,140,0,0.1);
        --danger: #f03e3e; --danger-bg: rgba(240,62,62,0.1);
        --shadow: 0 1px 3px rgba(0,0,0,0.3);
      }
    }
    body { font-family: var(--font); background: var(--bg); color: var(--text); line-height: 1.5; min-height: 100vh; -webkit-font-smoothing: antialiased; }

    /* â”€â”€â”€ Setup Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #setup-banner { display: none; background: var(--warning-bg); border: 1px solid var(--warning); border-radius: var(--radius); padding: 16px 20px; margin: 20px; }
    #setup-banner h3 { color: var(--warning); margin-bottom: 8px; }
    #setup-banner input { padding: 8px 12px; background: var(--bg); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text); font-size: 14px; width: 400px; max-width: 100%; }
    #setup-banner button { padding: 8px 16px; background: var(--warning); border: none; border-radius: var(--radius); color: #000; font-weight: 600; cursor: pointer; margin-left: 8px; }

    /* â”€â”€â”€ Login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #login-screen { display: flex; align-items: center; justify-content: center; min-height: 100vh; }
    #login-box { width: 380px; max-width: 90vw; }
    #login-box h1 { text-align: center; font-size: 22px; margin-bottom: 4px; }
    #login-box .subtitle { text-align: center; color: var(--text-dim); font-size: 13px; margin-bottom: 32px; }
    #login-error { display: none; background: var(--danger-bg); border: 1px solid var(--danger); border-radius: var(--radius); padding: 10px 14px; margin-bottom: 16px; font-size: 13px; color: var(--danger); }
    .form-group { margin-bottom: 14px; }
    .form-label { display: block; font-size: 12px; color: var(--text-dim); margin-bottom: 4px; font-weight: 500; }
    .input { width: 100%; padding: 10px 14px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text); font-size: 14px; outline: none; transition: border-color 0.15s; }
    .input:focus { border-color: var(--primary); }
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 10px 20px; border-radius: var(--radius); font-size: 14px; font-weight: 600; cursor: pointer; border: 1px solid var(--border); background: var(--surface); color: var(--text); transition: all 0.15s; text-decoration: none; }
    .btn:hover { border-color: var(--border-hover); background: var(--surface-hover); }
    .btn-primary { background: var(--primary); border-color: var(--primary); color: #fff; width: 100%; }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-sm { padding: 6px 12px; font-size: 12px; }
    .btn-danger { color: var(--danger); border-color: var(--danger); }
    .btn-danger:hover { background: var(--danger-bg); }

    /* â”€â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #app { display: none; }
    .layout { display: flex; min-height: 100vh; }
    .sidebar { width: 240px; background: var(--surface); border-right: 1px solid var(--border); position: fixed; top: 0; left: 0; bottom: 0; display: flex; flex-direction: column; }
    .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
    .sidebar-header h2 { font-size: 16px; letter-spacing: -0.02em; }
    .sidebar-header h2 em { font-style: normal; color: var(--primary); }
    .sidebar-header p { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
    .nav { flex: 1; padding: 8px 0; }
    .nav-section { font-size: 10px; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); padding: 12px 20px 4px; }
    .nav-item { display: flex; align-items: center; gap: 10px; padding: 10px 20px; color: var(--text-dim); cursor: pointer; font-size: 13px; border: none; background: none; width: 100%; text-align: left; transition: all 0.1s; }
    .nav-item:hover { color: var(--text); background: rgba(255,255,255,0.03); }
    .nav-item.active { color: var(--primary); background: var(--primary-bg); border-right: 2px solid var(--primary); }
    .sidebar-footer { padding: 16px 20px; border-top: 1px solid var(--border); font-size: 12px; }
    .sidebar-footer .name { color: var(--text-dim); }
    .sidebar-footer .email { color: var(--text-muted); font-size: 11px; }
    .sidebar-footer a { color: var(--text-muted); font-size: 11px; cursor: pointer; margin-top: 6px; display: inline-block; }

    .content { flex: 1; margin-left: 240px; padding: 32px; max-width: 1100px; }
    .page-title { font-size: 22px; font-weight: 700; letter-spacing: -0.02em; margin-bottom: 4px; }
    .page-desc { font-size: 13px; color: var(--text-dim); margin-bottom: 24px; }

    /* â”€â”€â”€ Cards & Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 20px; }
    .stat-card .label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; }
    .stat-card .value { font-size: 30px; font-weight: 700; margin-top: 4px; letter-spacing: -0.03em; }

    .card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 20px; margin-bottom: 16px; box-shadow: var(--shadow); }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .card-title { font-size: 13px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; }

    /* â”€â”€â”€ Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .table-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th { text-align: left; padding: 10px 12px; color: var(--text-muted); font-weight: 600; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid var(--border); }
    td { padding: 12px; border-bottom: 1px solid var(--border); }
    tr:hover td { background: rgba(255,255,255,0.015); }
    .badge { display: inline-block; padding: 2px 10px; border-radius: 999px; font-size: 11px; font-weight: 600; }
    .badge-active { background: var(--success-bg); color: var(--success); }
    .badge-archived { background: rgba(136,136,160,0.12); color: var(--text-dim); }
    .badge-suspended { background: var(--danger-bg); color: var(--danger); }
    .badge-owner { background: var(--warning-bg); color: var(--warning); }
    .badge-admin { background: var(--primary-bg); color: var(--primary); }
    .badge-member { background: rgba(136,136,160,0.08); color: var(--text-dim); }
    .badge-viewer { background: rgba(136,136,160,0.06); color: var(--text-muted); }
    .empty { text-align: center; padding: 48px 20px; color: var(--text-muted); }
    .empty-icon { font-size: 36px; margin-bottom: 10px; }

    /* â”€â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; z-index: 100; }
    .modal-overlay.open { display: flex; }
    .modal { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 24px; width: 440px; max-width: 90vw; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
    .modal h3 { font-size: 16px; font-weight: 700; margin-bottom: 16px; }
    .modal-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 20px; }

    /* â”€â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast { position: fixed; bottom: 24px; right: 24px; padding: 12px 20px; background: var(--surface); border: 1px solid var(--success); border-radius: var(--radius); font-size: 13px; z-index: 200; display: none; animation: slideUp 0.2s ease; }
    #toast.error { border-color: var(--danger); }
    @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 768px) {
      .sidebar { width: 56px; }
      .sidebar-header h2, .sidebar-header p, .nav-item span, .nav-section, .sidebar-footer { display: none; }
      .nav-item { justify-content: center; padding: 14px 0; font-size: 18px; }
      .content { margin-left: 56px; padding: 16px; }
    }
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CONFIGURATION â€” Edit this ONE line to get started
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
  // ğŸ‘‡ Change this to your ğŸ€ AgenticMail Enterprise server URL
  var API_URL = 'http://localhost:3000';
</script>

<!-- Setup banner (shown if API_URL is still localhost) -->
<div id="setup-banner">
  <h3>âš¡ Quick Setup</h3>
  <p style="color:var(--text-dim);font-size:13px;margin-bottom:12px;">Enter your ğŸ€ AgenticMail Enterprise server URL to get started:</p>
  <div>
    <input type="text" id="setup-url" placeholder="https://your-company.agenticmail.cloud" value="">
    <button onclick="saveApiUrl()">Connect</button>
  </div>
</div>

<!-- Login Screen -->
<div id="login-screen">
  <div id="login-box">
    <h1>ğŸ¢ <em style="color:var(--primary)">AgenticMail</em> Enterprise</h1>
    <p class="subtitle">Sign in to your dashboard</p>
    <div id="login-error"></div>
    <form onsubmit="doLogin(event)">
      <div class="form-group">
        <label class="form-label">Email</label>
        <input class="input" type="email" id="login-email" required autofocus>
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input class="input" type="password" id="login-password" required>
      </div>
      <button class="btn btn-primary" type="submit" id="login-btn">Sign In</button>
    </form>
  </div>
</div>

<!-- Main App -->
<div id="app">
  <div class="layout">
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>ğŸ¢ <em>Agentic</em>Mail</h2>
        <p>Enterprise Dashboard</p>
      </div>
      <div class="nav">
        <div class="nav-section">Overview</div>
        <button class="nav-item active" onclick="navigate('dashboard')" data-page="dashboard">ğŸ“Š <span>Dashboard</span></button>
        <div class="nav-section">Manage</div>
        <button class="nav-item" onclick="navigate('agents')" data-page="agents">ğŸ¤– <span>Agents</span></button>
        <button class="nav-item" onclick="navigate('users')" data-page="users">ğŸ‘¥ <span>Users</span></button>
        <button class="nav-item" onclick="navigate('api-keys')" data-page="api-keys">ğŸ”‘ <span>API Keys</span></button>
        <div class="nav-section">System</div>
        <button class="nav-item" onclick="navigate('audit')" data-page="audit">ğŸ“‹ <span>Audit Log</span></button>
        <button class="nav-item" onclick="navigate('settings')" data-page="settings">âš™ï¸ <span>Settings</span></button>
      </div>
      <div class="sidebar-footer">
        <div class="name" id="user-name">-</div>
        <div class="email" id="user-email">-</div>
        <a onclick="doLogout()">Sign out</a>
      </div>
    </div>

    <div class="content" id="page-content">
      <!-- Pages injected here by JS -->
    </div>
  </div>
</div>

<!-- Create Agent Modal -->
<div class="modal-overlay" id="modal-agent">
  <div class="modal">
    <h3>Create Agent</h3>
    <form onsubmit="createAgent(event)">
      <div class="form-group"><label class="form-label">Name</label><input class="input" id="agent-name" required placeholder="e.g. researcher"></div>
      <div class="form-group"><label class="form-label">Email (optional)</label><input class="input" id="agent-email" placeholder="auto-generated if blank"></div>
      <div class="form-group"><label class="form-label">Role</label>
        <select class="input" id="agent-role"><option>assistant</option><option>secretary</option><option>researcher</option><option>writer</option><option>custom</option></select>
      </div>
      <div class="modal-actions">
        <button class="btn" type="button" onclick="closeModal('modal-agent')">Cancel</button>
        <button class="btn btn-primary" type="submit" style="width:auto">Create</button>
      </div>
    </form>
  </div>
</div>

<!-- Create User Modal -->
<div class="modal-overlay" id="modal-user">
  <div class="modal">
    <h3>Create User</h3>
    <form onsubmit="createUser(event)">
      <div class="form-group"><label class="form-label">Name</label><input class="input" id="new-user-name" required></div>
      <div class="form-group"><label class="form-label">Email</label><input class="input" type="email" id="new-user-email" required></div>
      <div class="form-group"><label class="form-label">Role</label>
        <select class="input" id="new-user-role"><option>member</option><option>admin</option><option>owner</option><option>viewer</option></select>
      </div>
      <div class="form-group"><label class="form-label">Password</label><input class="input" type="password" id="new-user-password" required minlength="8"></div>
      <div class="modal-actions">
        <button class="btn" type="button" onclick="closeModal('modal-user')">Cancel</button>
        <button class="btn btn-primary" type="submit" style="width:auto">Create</button>
      </div>
    </form>
  </div>
</div>

<!-- Create API Key Modal -->
<div class="modal-overlay" id="modal-apikey">
  <div class="modal">
    <h3>Create API Key</h3>
    <form onsubmit="createApiKey(event)">
      <div class="form-group"><label class="form-label">Key Name</label><input class="input" id="apikey-name" required placeholder="e.g. CI/CD pipeline"></div>
      <div class="modal-actions">
        <button class="btn" type="button" onclick="closeModal('modal-apikey')">Cancel</button>
        <button class="btn btn-primary" type="submit" style="width:auto">Create</button>
      </div>
    </form>
  </div>
</div>

<!-- Toast -->
<div id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ€ AgenticMail Enterprise â€” Pure JavaScript Dashboard
// No frameworks, no build tools, no dependencies.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var token = localStorage.getItem('am_token');
var currentUser = null;
var currentPage = 'dashboard';

// â”€â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function apiUrl() { return localStorage.getItem('am_api_url') || API_URL; }

function api(path, opts) {
  opts = opts || {};
  var headers = { 'Content-Type': 'application/json' };
  if (token) headers['Authorization'] = 'Bearer ' + token;
  return fetch(apiUrl() + '/api' + path, {
    method: opts.method || 'GET',
    headers: headers,
    body: opts.body ? JSON.stringify(opts.body) : undefined,
  }).then(function(r) { return r.json().then(function(d) { if (!r.ok) throw new Error(d.error || 'Request failed'); return d; }); });
}

// â”€â”€â”€ Setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function saveApiUrl() {
  var url = document.getElementById('setup-url').value.trim().replace(/\/+$/, '');
  if (!url) return;
  localStorage.setItem('am_api_url', url);
  API_URL = url;
  document.getElementById('setup-banner').style.display = 'none';
  location.reload();
}

// â”€â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function doLogin(e) {
  e.preventDefault();
  var btn = document.getElementById('login-btn');
  btn.textContent = 'Signing in...'; btn.disabled = true;
  fetch(apiUrl() + '/auth/login', {
    method: 'POST', headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email: document.getElementById('login-email').value, password: document.getElementById('login-password').value }),
  }).then(function(r) { return r.json(); }).then(function(d) {
    if (d.error) throw new Error(d.error);
    token = d.token;
    localStorage.setItem('am_token', d.token);
    currentUser = d.user;
    showApp();
  }).catch(function(err) {
    document.getElementById('login-error').style.display = 'block';
    document.getElementById('login-error').textContent = err.message;
  }).finally(function() { btn.textContent = 'Sign In'; btn.disabled = false; });
}

function doLogout() {
  localStorage.removeItem('am_token'); token = null; currentUser = null;
  document.getElementById('app').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
}

function checkAuth() {
  if (!token) return;
  fetch(apiUrl() + '/auth/me', { headers: { 'Authorization': 'Bearer ' + token } })
    .then(function(r) { if (!r.ok) throw new Error(); return r.json(); })
    .then(function(u) { currentUser = u; showApp(); })
    .catch(function() { localStorage.removeItem('am_token'); token = null; });
}

function showApp() {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  document.getElementById('user-name').textContent = currentUser.name;
  document.getElementById('user-email').textContent = currentUser.email;
  navigate('dashboard');
}

// â”€â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function navigate(page) {
  currentPage = page;
  document.querySelectorAll('.nav-item').forEach(function(el) {
    el.classList.toggle('active', el.getAttribute('data-page') === page);
  });
  var pages = { dashboard: renderDashboard, agents: renderAgents, users: renderUsers, 'api-keys': renderApiKeys, audit: renderAudit, settings: renderSettings };
  (pages[page] || renderDashboard)();
}

// â”€â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function toast(msg, type) {
  var el = document.getElementById('toast');
  el.textContent = msg; el.className = type || ''; el.style.display = 'block';
  clearTimeout(el._t);
  el._t = setTimeout(function() { el.style.display = 'none'; }, 3000);
}

// â”€â”€â”€ Modals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }

// â”€â”€â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderDashboard() {
  var el = document.getElementById('page-content');
  el.innerHTML = '<h2 class="page-title">Dashboard</h2><p class="page-desc">Loading...</p>';
  api('/stats').then(function(s) {
    api('/audit?limit=8').then(function(a) {
      var events = (a.events || []).map(function(e) {
        return '<div style="padding:10px 0;border-bottom:1px solid var(--border);font-size:13px">' +
          '<span style="color:var(--primary);font-weight:500">' + esc(e.action) + '</span> on ' + esc(e.resource) +
          '<div style="font-size:11px;color:var(--text-muted)">' + new Date(e.timestamp).toLocaleString() + (e.ip ? ' Â· ' + e.ip : '') + '</div></div>';
      }).join('');
      el.innerHTML = '<h2 class="page-title">Dashboard</h2><p class="page-desc">Overview of your AgenticMail instance</p>' +
        '<div class="stats-row">' +
        stat('Total Agents', s.totalAgents, 'var(--primary)') +
        stat('Active Agents', s.activeAgents, 'var(--success)') +
        stat('Users', s.totalUsers, 'var(--text)') +
        stat('Audit Events', s.totalAuditEvents, 'var(--text)') +
        '</div>' +
        '<div class="card"><div class="card-title">Recent Activity</div>' +
        (events || '<div class="empty"><div class="empty-icon">ğŸ“‹</div>No activity yet</div>') +
        '</div>';
    });
  });
}

function stat(label, value, color) {
  return '<div class="stat-card"><div class="label">' + label + '</div><div class="value" style="color:' + color + '">' + value + '</div></div>';
}

// â”€â”€â”€ Agents â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderAgents() {
  var el = document.getElementById('page-content');
  el.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px"><div><h2 class="page-title">Agents</h2><p class="page-desc" style="margin:0">Manage AI agent identities</p></div><button class="btn btn-primary" style="width:auto" onclick="openModal(\'modal-agent\')">+ New Agent</button></div><div class="card"><div class="page-desc">Loading...</div></div>';
  api('/agents').then(function(d) {
    var agents = d.agents || [];
    if (agents.length === 0) { el.querySelector('.card').innerHTML = '<div class="empty"><div class="empty-icon">ğŸ¤–</div>No agents yet. Create your first one!</div>'; return; }
    var rows = agents.map(function(a) {
      return '<tr><td style="font-weight:600">' + esc(a.name) + '</td><td style="color:var(--text-dim)">' + esc(a.email) + '</td><td>' + esc(a.role) + '</td><td><span class="badge badge-' + a.status + '">' + a.status + '</span></td><td style="color:var(--text-muted);font-size:12px">' + new Date(a.createdAt).toLocaleDateString() + '</td><td>' + (a.status === 'active' ? '<button class="btn btn-sm btn-danger" onclick="archiveAgent(\'' + a.id + '\')">Archive</button>' : '') + '</td></tr>';
    }).join('');
    el.querySelector('.card').innerHTML = '<div class="table-wrap"><table><thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Status</th><th>Created</th><th></th></tr></thead><tbody>' + rows + '</tbody></table></div>';
  });
}

function createAgent(e) {
  e.preventDefault();
  api('/agents', { method: 'POST', body: { name: document.getElementById('agent-name').value, email: document.getElementById('agent-email').value || undefined, role: document.getElementById('agent-role').value } })
    .then(function() { toast('Agent created!', 'success'); closeModal('modal-agent'); renderAgents(); })
    .catch(function(err) { toast(err.message, 'error'); });
}

function archiveAgent(id) {
  api('/agents/' + id + '/archive', { method: 'POST' })
    .then(function() { toast('Agent archived', 'success'); renderAgents(); })
    .catch(function(err) { toast(err.message, 'error'); });
}

// â”€â”€â”€ Users â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderUsers() {
  var el = document.getElementById('page-content');
  el.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px"><div><h2 class="page-title">Users</h2><p class="page-desc" style="margin:0">Manage team members</p></div><button class="btn btn-primary" style="width:auto" onclick="openModal(\'modal-user\')">+ New User</button></div><div class="card"><div class="page-desc">Loading...</div></div>';
  api('/users').then(function(d) {
    var users = d.users || [];
    if (users.length === 0) { el.querySelector('.card').innerHTML = '<div class="empty"><div class="empty-icon">ğŸ‘¥</div>No users yet</div>'; return; }
    var rows = users.map(function(u) {
      return '<tr><td style="font-weight:600">' + esc(u.name) + '</td><td style="color:var(--text-dim)">' + esc(u.email) + '</td><td><span class="badge badge-' + u.role + '">' + u.role + '</span></td><td style="color:var(--text-muted);font-size:12px">' + (u.lastLoginAt ? new Date(u.lastLoginAt).toLocaleString() : 'Never') + '</td></tr>';
    }).join('');
    el.querySelector('.card').innerHTML = '<div class="table-wrap"><table><thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Last Login</th></tr></thead><tbody>' + rows + '</tbody></table></div>';
  });
}

function createUser(e) {
  e.preventDefault();
  api('/users', { method: 'POST', body: { name: document.getElementById('new-user-name').value, email: document.getElementById('new-user-email').value, role: document.getElementById('new-user-role').value, password: document.getElementById('new-user-password').value } })
    .then(function() { toast('User created!', 'success'); closeModal('modal-user'); renderUsers(); })
    .catch(function(err) { toast(err.message, 'error'); });
}

// â”€â”€â”€ API Keys â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderApiKeys() {
  var el = document.getElementById('page-content');
  el.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px"><div><h2 class="page-title">API Keys</h2><p class="page-desc" style="margin:0">Manage programmatic access</p></div><button class="btn btn-primary" style="width:auto" onclick="openModal(\'modal-apikey\')">+ New Key</button></div><div id="apikey-banner"></div><div class="card"><div class="page-desc">Loading...</div></div>';
  api('/api-keys').then(function(d) {
    var keys = d.keys || [];
    if (keys.length === 0) { el.querySelector('.card').innerHTML = '<div class="empty"><div class="empty-icon">ğŸ”‘</div>No API keys</div>'; return; }
    var rows = keys.map(function(k) {
      return '<tr><td style="font-weight:600">' + esc(k.name) + '</td><td><code style="font-size:12px">' + esc(k.keyPrefix) + '...</code></td><td style="font-size:12px">' + (k.scopes || []).join(', ') + '</td><td style="color:var(--text-muted);font-size:12px">' + (k.lastUsedAt ? new Date(k.lastUsedAt).toLocaleString() : 'Never') + '</td><td><span class="badge ' + (k.revoked ? 'badge-archived' : 'badge-active') + '">' + (k.revoked ? 'revoked' : 'active') + '</span></td><td>' + (!k.revoked ? '<button class="btn btn-sm btn-danger" onclick="revokeApiKey(\'' + k.id + '\')">Revoke</button>' : '') + '</td></tr>';
    }).join('');
    el.querySelector('.card').innerHTML = '<div class="table-wrap"><table><thead><tr><th>Name</th><th>Key</th><th>Scopes</th><th>Last Used</th><th>Status</th><th></th></tr></thead><tbody>' + rows + '</tbody></table></div>';
  });
}

function createApiKey(e) {
  e.preventDefault();
  api('/api-keys', { method: 'POST', body: { name: document.getElementById('apikey-name').value } })
    .then(function(d) {
      closeModal('modal-apikey');
      document.getElementById('apikey-banner').innerHTML = '<div class="card" style="border-color:var(--warning);background:var(--warning-bg)"><div style="font-weight:600;color:var(--warning);margin-bottom:8px">âš ï¸ Copy this key now â€” it won\'t be shown again</div><code style="display:block;background:var(--bg);padding:10px 14px;border-radius:var(--radius);font-size:13px;word-break:break-all;cursor:pointer" onclick="navigator.clipboard.writeText(\'' + d.plaintext + '\');toast(\'Copied!\',\'success\')">' + d.plaintext + '</code><button class="btn btn-sm" style="margin-top:8px" onclick="this.parentElement.remove()">Dismiss</button></div>';
      renderApiKeys();
    })
    .catch(function(err) { toast(err.message, 'error'); });
}

function revokeApiKey(id) {
  api('/api-keys/' + id, { method: 'DELETE' })
    .then(function() { toast('Key revoked', 'success'); renderApiKeys(); })
    .catch(function(err) { toast(err.message, 'error'); });
}

// â”€â”€â”€ Audit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

var auditPage = 0;
function renderAudit() {
  var el = document.getElementById('page-content');
  el.innerHTML = '<h2 class="page-title">Audit Log</h2><p class="page-desc">Loading...</p>';
  api('/audit?limit=25&offset=' + (auditPage * 25)).then(function(d) {
    var events = d.events || [];
    var total = d.total || 0;
    var pages = Math.ceil(total / 25) || 1;
    if (events.length === 0) { el.innerHTML = '<h2 class="page-title">Audit Log</h2><p class="page-desc">0 events</p><div class="card"><div class="empty"><div class="empty-icon">ğŸ“‹</div>No audit events yet</div></div>'; return; }
    var rows = events.map(function(e) {
      return '<tr><td style="font-size:12px;color:var(--text-muted);white-space:nowrap">' + new Date(e.timestamp).toLocaleString() + '</td><td>' + esc(e.actor) + '</td><td style="color:var(--primary);font-weight:500">' + esc(e.action) + '</td><td style="font-size:12px">' + esc(e.resource) + '</td><td style="font-size:12px;color:var(--text-muted)">' + (e.ip || '-') + '</td></tr>';
    }).join('');
    el.innerHTML = '<h2 class="page-title">Audit Log</h2><p class="page-desc">' + total + ' total events</p><div class="card"><div class="table-wrap"><table><thead><tr><th>Time</th><th>Actor</th><th>Action</th><th>Resource</th><th>IP</th></tr></thead><tbody>' + rows + '</tbody></table></div><div style="display:flex;gap:8px;justify-content:center;margin-top:16px"><button class="btn btn-sm" ' + (auditPage === 0 ? 'disabled' : '') + ' onclick="auditPage--;renderAudit()">â† Prev</button><span style="padding:6px 12px;font-size:12px;color:var(--text-muted)">Page ' + (auditPage + 1) + ' of ' + pages + '</span><button class="btn btn-sm" ' + ((auditPage + 1) * 25 >= total ? 'disabled' : '') + ' onclick="auditPage++;renderAudit()">Next â†’</button></div></div>';
  });
}

// â”€â”€â”€ Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderSettings() {
  var el = document.getElementById('page-content');
  el.innerHTML = '<h2 class="page-title">Settings</h2><p class="page-desc">Loading...</p>';
  Promise.all([api('/settings').catch(function() { return {}; }), api('/retention').catch(function() { return { enabled: false, retainDays: 365 }; })])
    .then(function(results) {
      var s = results[0], r = results[1];
      el.innerHTML = '<h2 class="page-title">Settings</h2><p class="page-desc">Configure your organization</p>' +
        '<div class="card"><div class="card-title">General</div>' +
        '<form onsubmit="saveSettings(event)" style="display:grid;grid-template-columns:1fr 1fr;gap:14px">' +
        '<div class="form-group"><label class="form-label">Organization Name</label><input class="input" id="set-name" value="' + esc(s.name || '') + '"></div>' +
        '<div class="form-group"><label class="form-label">Domain</label><input class="input" id="set-domain" value="' + esc(s.domain || '') + '" placeholder="agents.acme.com"></div>' +
        '<div class="form-group"><label class="form-label">Primary Color</label><input class="input" type="color" id="set-color" value="' + (s.primaryColor || '#e84393') + '" style="height:38px;padding:4px"></div>' +
        '<div class="form-group"><label class="form-label">Logo URL</label><input class="input" id="set-logo" value="' + esc(s.logoUrl || '') + '" placeholder="https://..."></div>' +
        '<div style="grid-column:span 2"><button class="btn btn-primary" type="submit" style="width:auto">Save Settings</button></div></form></div>' +
        '<div class="card"><div class="card-title">Plan</div>' +
        '<span class="badge badge-active" style="font-size:14px;padding:4px 12px">' + (s.plan || 'free').toUpperCase() + '</span> ' +
        '<span style="font-size:13px;color:var(--text-dim)">Subdomain: ' + esc(s.subdomain || 'not set') + '.agenticmail.cloud</span></div>' +
        '<div class="card"><div class="card-title">Data Retention</div><div style="font-size:13px">' +
        'Status: <span style="color:' + (r.enabled ? 'var(--success)' : 'var(--text-muted)') + '">' + (r.enabled ? 'Enabled' : 'Disabled') + '</span><br>' +
        '<span style="color:var(--text-dim)">Retain emails for ' + r.retainDays + ' days' + (r.archiveFirst ? ' (archive before delete)' : '') + '</span></div></div>';
    });
}

function saveSettings(e) {
  e.preventDefault();
  api('/settings', { method: 'PATCH', body: { name: document.getElementById('set-name').value, domain: document.getElementById('set-domain').value, primaryColor: document.getElementById('set-color').value, logoUrl: document.getElementById('set-logo').value } })
    .then(function() { toast('Settings saved!', 'success'); })
    .catch(function(err) { toast(err.message, 'error'); });
}

// â”€â”€â”€ Util â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function esc(s) { var d = document.createElement('div'); d.textContent = s || ''; return d.innerHTML; }

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

if (API_URL === 'http://localhost:3000' && !localStorage.getItem('am_api_url')) {
  document.getElementById('setup-banner').style.display = 'block';
}
checkAuth();
</script>
</body>
</html>
