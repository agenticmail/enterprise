{% extends "layout.html" %}

{% block content %}
<div class="page-header">
  <h1>Compliance</h1>
  <p>Generate and review compliance reports</p>
</div>

<div class="card">
  <h3>Generate Report</h3>
  <form method="POST" action="{{ url_for('compliance_bp.generate_report') }}" style="display: flex; gap: 10px; align-items: end; flex-wrap: wrap;">
    <div class="form-group" style="margin: 0;">
      <label>Report Type</label>
      <select name="type">
        <option value="soc2">SOC 2</option>
        <option value="gdpr">GDPR</option>
        <option value="audit">Audit</option>
      </select>
    </div>
    <div class="form-group" style="margin: 0;">
      <label>Start Date</label>
      <input type="date" name="startDate">
    </div>
    <div class="form-group" style="margin: 0;">
      <label>End Date</label>
      <input type="date" name="endDate">
    </div>
    <div class="form-group" style="flex: 1; margin: 0;">
      <label>Agent ID (optional)</label>
      <input type="text" name="agentId" placeholder="e.g. agent-123">
    </div>
    <button class="btn btn-primary" type="submit">Generate</button>
  </form>
</div>

<div class="card">
  {% if reports %}
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Generated</th>
          <th>Period</th>
          <th>Status</th>
          <th>Agent</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for r in reports %}
        <tr>
          <td style="font-weight: 600;">{{ r.type or '-' }}</td>
          <td style="font-size: 12px; color: var(--text-muted);">{{ r.createdAt|time_ago }}</td>
          <td style="font-size: 12px;">{{ r.startDate or '-' }} &mdash; {{ r.endDate or '-' }}</td>
          <td>{{ r.status|status_badge }}</td>
          <td style="font-size: 12px;">{{ r.agentId or 'All' }}</td>
          <td>
            {% if r.downloadUrl %}
            <a href="{{ r.downloadUrl }}" class="btn btn-sm btn-primary">Download</a>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty">
    <span class="icon">No compliance reports yet</span>
  </div>
  {% endif %}
</div>
{% endblock %}
