{% extends "layout.html" %}

{% block content %}
<div class="page-header">
  <h1>Vault</h1>
  <p>Manage secrets and credentials</p>
</div>

<div class="card">
  <h3>Add Secret</h3>
  <form method="POST" action="{{ url_for('vault_bp.add_secret') }}" style="display: flex; gap: 10px; align-items: end; flex-wrap: wrap;">
    <div class="form-group" style="flex: 1; margin: 0;">
      <label>Name</label>
      <input type="text" name="name" required placeholder="e.g. OPENAI_API_KEY">
    </div>
    <div class="form-group" style="flex: 1; margin: 0;">
      <label>Value</label>
      <input type="password" name="value" required placeholder="Secret value">
    </div>
    <div class="form-group" style="margin: 0;">
      <label>Category</label>
      <select name="category">
        <option value="api_key">API Key</option>
        <option value="deploy">Deploy</option>
        <option value="cloud_storage">Cloud Storage</option>
        <option value="skill_credential">Skill Credential</option>
        <option value="custom" selected>Custom</option>
      </select>
    </div>
    <button class="btn btn-primary" type="submit">Add</button>
  </form>
</div>

<div class="card">
  {% if secrets %}
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Category</th>
          <th>Created By</th>
          <th>Created</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for s in secrets %}
        <tr>
          <td style="font-weight: 600; font-family: monospace;">{{ s.name }}</td>
          <td>{{ (s.category or 'custom')|badge }}</td>
          <td style="color: var(--text-muted); font-size: 12px;">{{ s.createdBy or s.created_by or '-' }}</td>
          <td style="color: var(--text-muted); font-size: 12px;">{{ s.createdAt|time_ago if s.createdAt else (s.created_at|time_ago if s.created_at else '-') }}</td>
          <td style="display: flex; gap: 4px;">
            <form method="POST" action="{{ url_for('vault_bp.rotate_secret', id=s.id) }}" style="display: inline;">
              <button class="btn btn-sm btn-primary" type="submit">Rotate</button>
            </form>
            <form method="POST" action="{{ url_for('vault_bp.delete_secret', id=s.id) }}" style="display: inline;">
              <button class="btn btn-sm btn-danger" type="submit">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty">
    <span class="icon">No secrets stored</span>
  </div>
  {% endif %}
</div>
{% endblock %}
