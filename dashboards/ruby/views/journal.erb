<div class="page-header">
  <h1>Journal</h1>
  <p>Action journal with rollback capabilities</p>
</div>

<div class="card">
  <h3>Journal Stats</h3>
  <div class="form-row">
    <div class="form-group">
      <label>Total Entries</label>
      <div><strong><%= @stats['total'] || @stats['total_entries'] || 0 %></strong></div>
    </div>
    <div class="form-group">
      <label>Rollbacks</label>
      <div><strong><%= @stats['rollbacks'] || @stats['total_rollbacks'] || 0 %></strong></div>
    </div>
    <div class="form-group">
      <label>Pending</label>
      <div><strong><%= @stats['pending'] || 0 %></strong></div>
    </div>
  </div>
</div>

<div class="card">
  <h3>Journal Entries (<%= @entries.size %>)</h3>
  <% if @entries.empty? %>
    <div class="empty"><span class="icon">&#128214;</span>No journal entries recorded</div>
  <% else %>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Action</th><th>Agent</th><th>Resource</th><th>Status</th><th>Time</th><th>Actions</th></tr></thead>
        <tbody>
          <% @entries.each do |e| %>
            <tr>
              <td><strong><%= escape_html(e['action'] || e['type'] || '-') %></strong></td>
              <td><%= escape_html(e['agent'] || e['agent_id'] || '-') %></td>
              <td><code><%= escape_html(e['resource'] || e['target'] || '-') %></code></td>
              <td><%= status_badge(e['status'] || 'completed') %></td>
              <td style="color:var(--text-muted)"><%= time_ago(e['created_at'] || e['timestamp']) %></td>
              <td>
                <% unless (e['status'] || '').downcase == 'rolled_back' %>
                  <form method="post" action="/journal/<%= e['id'] %>/rollback" style="display:inline" onsubmit="return confirm('Rollback this action?')">
                    <button class="btn btn-sm btn-danger" type="submit">Rollback</button>
                  </form>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>
