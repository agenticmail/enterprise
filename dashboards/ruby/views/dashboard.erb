<div class="page-header">
  <h1>Dashboard</h1>
  <p>Overview of your AgenticMail Enterprise instance</p>
</div>

<div class="stats-grid">
  <div class="stat-card">
    <div class="label">Total Agents</div>
    <div class="value pink"><%= @stats['agents'] || @stats['totalAgents'] || @stats['total_agents'] || 0 %></div>
  </div>
  <div class="stat-card">
    <div class="label">Active Agents</div>
    <div class="value"><%= @stats['activeAgents'] || @stats['active_agents'] || 0 %></div>
  </div>
  <div class="stat-card">
    <div class="label">Total Users</div>
    <div class="value"><%= @stats['users'] || @stats['totalUsers'] || @stats['total_users'] || 0 %></div>
  </div>
  <div class="stat-card">
    <div class="label">Audit Events</div>
    <div class="value"><%= @stats['totalAuditEvents'] || @stats['total_audit_events'] || @stats['audit_events'] || 0 %></div>
  </div>
</div>

<div class="card">
  <h3>Recent Audit Events</h3>
  <% if @audit.empty? %>
    <div class="empty"><span class="icon">&#128220;</span>No recent audit events</div>
  <% else %>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Event</th><th>Actor</th><th>Resource</th><th>Time</th></tr></thead>
        <tbody>
          <% @audit.each do |ev| %>
            <tr>
              <td><%= escape_html(ev['action'] || ev['event'] || 'unknown') %></td>
              <td><%= escape_html(ev['actor'] || ev['user'] || ev['email'] || '-') %></td>
              <td><%= escape_html(ev['resource'] || ev['target'] || '-') %></td>
              <td style="color:var(--text-muted)"><%= time_ago(ev['created_at'] || ev['timestamp']) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>
