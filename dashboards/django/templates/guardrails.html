{% extends "layout.html" %}
{% block content %}
<h2 class="t">Guardrails</h2>
<p class="desc">Agent controls, intervention log, and anomaly detection rules</p>
<div class="card" style="margin-bottom:16px">
<div class="ct">Create Anomaly Rule</div>
<form method="POST" style="display:flex;gap:10px;align-items:end">
<input type="hidden" name="_action" value="create_rule">
<div class="fg" style="flex:1;margin:0"><label class="fl">Name</label><input class="input" name="name" required placeholder="e.g. high-volume-send"></div>
<div class="fg" style="flex:1;margin:0"><label class="fl">Condition</label><input class="input" name="condition" required placeholder="e.g. sends > 100 per hour"></div>
<div class="fg" style="margin:0"><label class="fl">Action</label><select class="input" name="rule_action"><option>alert</option><option>pause</option><option>kill</option></select></div>
<button class="btn btn-p" type="submit">Create</button>
</form>
</div>
<div class="card" style="margin-bottom:16px">
<div class="ct">Interventions</div>
{% if interventions %}
<table>
<thead><tr><th>Time</th><th>Agent</th><th>Reason</th><th>Status</th><th>Actions</th></tr></thead>
<tbody>
{% for i in interventions %}
<tr>
<td style="font-size:12px;color:var(--muted)">{{ i.timestamp }}</td>
<td style="font-weight:600">{{ i.agentName|default:i.agent_name }}</td>
<td style="font-size:12px">{{ i.reason|default:"-" }}</td>
<td>{{ i.status_badge|safe }}</td>
<td>
<form method="POST" style="display:inline">
<input type="hidden" name="agent_id" value="{{ i.agentId|default:i.agent_id }}">
<input type="hidden" name="_action" value="pause">
<button class="btn btn-sm" type="submit">Pause</button>
</form>
<form method="POST" style="display:inline">
<input type="hidden" name="agent_id" value="{{ i.agentId|default:i.agent_id }}">
<input type="hidden" name="_action" value="resume">
<button class="btn btn-sm btn-p" type="submit">Resume</button>
</form>
<form method="POST" style="display:inline">
<input type="hidden" name="agent_id" value="{{ i.agentId|default:i.agent_id }}">
<input type="hidden" name="_action" value="kill">
<button class="btn btn-sm btn-d" type="submit">Kill</button>
</form>
</td>
</tr>
{% endfor %}
</tbody>
</table>
{% else %}
<div class="empty">&#x2705; No interventions recorded</div>
{% endif %}
</div>
<div class="card">
<div class="ct">Anomaly Rules</div>
{% if anomaly_rules %}
<table>
<thead><tr><th>Name</th><th>Condition</th><th>Action</th><th></th></tr></thead>
<tbody>
{% for r in anomaly_rules %}
<tr>
<td style="font-weight:600">{{ r.name }}</td>
<td style="font-size:12px">{{ r.condition }}</td>
<td>{{ r.action }}</td>
<td>
<form method="POST" style="display:inline">
<input type="hidden" name="_action" value="delete_rule">
<input type="hidden" name="rule_id" value="{{ r.id }}">
<button class="btn btn-sm btn-d" type="submit">Delete</button>
</form>
</td>
</tr>
{% endfor %}
</tbody>
</table>
{% else %}
<div class="empty">&#x1f50d; No anomaly rules configured</div>
{% endif %}
</div>
{% endblock %}
