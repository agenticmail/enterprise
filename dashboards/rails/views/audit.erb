<div class="page-header">
  <h1>Audit Log</h1>
  <p>Security and activity event history</p>
</div>

<div class="card">
  <% if @events.empty? %>
    <div class="empty"><span class="icon">&#128220;</span>No audit events recorded</div>
  <% else %>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Event</th><th>Actor</th><th>Resource</th><th>IP Address</th><th>Time</th></tr></thead>
        <tbody>
          <% @events.each do |ev| %>
            <tr>
              <td><%= escape_html(ev['action'] || ev['event'] || 'unknown') %></td>
              <td><%= escape_html(ev['actor'] || ev['user'] || ev['email'] || '-') %></td>
              <td><%= escape_html(ev['resource'] || ev['target'] || '-') %></td>
              <td style="color:var(--muted)"><code><%= escape_html(ev['ip'] || ev['ip_address'] || '-') %></code></td>
              <td style="color:var(--muted)"><%= time_ago(ev['created_at'] || ev['timestamp']) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="pagination">
      <% if @page > 1 %>
        <a href="/audit?page=<%= @page - 1 %>">&laquo; Previous</a>
      <% end %>
      <span class="current">Page <%= @page %></span>
      <% if @events.size >= @limit %>
        <a href="/audit?page=<%= @page + 1 %>">Next &raquo;</a>
      <% end %>
      <span style="color:var(--muted);font-size:12px;margin-left:auto"><%= @total %> total events</span>
    </div>
  <% end %>
</div>
